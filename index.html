<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Guessing Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Apply Inter font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom class for feedback animation */
        .feedback-pop {
            animation: pop 0.5s ease-out;
        }
        @keyframes pop {
            0% { transform: scale(0.9); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        /* Ensure text is readable on any color button */
        .color-btn-text {
            text-shadow: 0 0 4px rgba(0, 0, 0, 0.5), 0 0 4px rgba(0, 0, 0, 0.5);
        }
         /* Scrollbar styling for color list */
        #color-list-container::-webkit-scrollbar {
            width: 8px;
        }
        #color-list-container::-webkit-scrollbar-track {
            background: #f5f5f5; /* neutral-100 */
            border-radius: 10px;
        }
        #color-list-container::-webkit-scrollbar-thumb {
            background: #a3a3a3; /* neutral-400 */
            border-radius: 10px;
        }
        #color-list-container::-webkit-scrollbar-thumb:hover {
            background: #737373; /* neutral-500 */
        }
        /* Dark mode scrollbar */
        .dark #color-list-container::-webkit-scrollbar-track {
            background: #525252; /* neutral-600 */
        }
        .dark #color-list-container::-webkit-scrollbar-thumb {
            background: #737373; /* neutral-500 */
        }
        .dark #color-list-container::-webkit-scrollbar-thumb:hover {
            background: #a3a3a3; /* neutral-400 */
        }
    </style>
</head>
<body class="bg-neutral-100 dark:bg-neutral-900 text-neutral-900 dark:text-neutral-100 min-h-screen flex items-center justify-center p-4 transition-colors duration-300">

    <div class="max-w-md w-full">
        <h1 class="text-3xl font-bold text-center mb-6">Color Guessing Game</h1>

        <div id="start-screen" class="bg-white dark:bg-neutral-800 rounded-lg shadow-xl p-8 text-center">
            <p class="text-lg mb-6">Guess the color from the name, or the name from the color. You have 20 rounds. Good luck!</p>
            <button id="start-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                Start Game
            </button>
            <div class="flex items-center justify-center my-6">
                <label for="hard-mode-toggle" class="flex items-center cursor-pointer">
                    <span class="mr-3 font-semibold text-neutral-700 dark:text-neutral-300">Hard Mode</span>
                    <div class="relative">
                        <input type="checkbox" id="hard-mode-toggle" class="sr-only peer">
                        <div class="w-12 h-7 bg-neutral-300 dark:bg-neutral-600 rounded-full shadow-inner transition-colors peer-checked:bg-red-600 dark:peer-checked:bg-red-500"></div>
                        <div class="absolute left-1 top-1 w-5 h-5 bg-white rounded-full shadow transition-transform peer-checked:translate-x-5"></div>
                    </div>
                </label>
            </div>
            
            <div class="my-6 text-left">
                <label for="library-select" class="block mb-2 font-semibold text-neutral-700 dark:text-neutral-300">Color Library</label>
                <select id="library-select" class="w-full bg-neutral-100 dark:bg-neutral-700 border border-neutral-300 dark:border-neutral-600 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="w3.csv" data-basename="W3 Colors">W3 Colors</option>
                    <option value="hexa.csv" data-basename="ColorHexa">ColorHexa</option>
                    <option value="crayola.csv" data-basename="Crayola">Crayola</option>
                    <option value="xkcd.csv" data-basename="XKCD">XKCD</option>
                    <option value="xkcd_small.csv" data-basename="XKCD Small">XKCD Small</option>
                </select>
            </div>
            <button id="help-btn" class="mt-4 text-sm text-blue-600 dark:text-blue-400 hover:underline focus:outline-none">
                Show Color Reference
            </button>
            <div class="mt-4 text-sm text-neutral-600 dark:text-neutral-400">
                <div>Best (Easy): <span id="start-best-score-easy">0</span></div>
                <div>Best (Hard): <span id="start-best-score-hard">0</span></div>
            </div>
        </div>
 
        <div id="game-screen" class="hidden">
            <div class="flex justify-between items-center mb-4 text-sm font-semibold bg-white dark:bg-neutral-800 rounded-lg shadow-lg p-4">
                <div>Score: <span id="score" class="font-bold text-lg text-blue-600 dark:text-blue-400">0</span></div>
                <div>Best: <span id="best-score" class="font-bold text-lg">0</span></div>
                <div>Round: <span id="current-round" class="font-bold text-lg">1</span> / <span id="total-rounds" class="font-bold text-lg">20</span></div>
            </div>

            <div class="bg-white dark:bg-neutral-800 rounded-lg shadow-xl p-6">
                <h2 id="question-text" class="text-xl font-semibold text-center mb-4 h-12 flex items-center justify-center"></h2>
                
                <div id="color-display" class="w-full h-48 md:h-64 rounded-lg mb-6 shadow-inner bg-neutral-200 dark:bg-neutral-700 flex items-center justify-center text-4xl font-bold text-center px-4" style="text-shadow: 0 0 8px rgba(0,0,0,0.3);">
                </div>

                <div id="options-container" class="grid grid-cols-2 gap-4">
                    </div>

                <div id="feedback" class="mt-6 text-center text-lg font-semibold h-8"></div>
            </div>
        </div>

        <div id="end-screen" class="hidden absolute inset-0 bg-neutral-900 bg-opacity-80 flex items-center justify-center p-4 z-40">
            <div class="bg-white dark:bg-neutral-800 rounded-lg shadow-2xl p-8 text-center w-full max-w-sm">
                <h2 class="text-3xl font-bold mb-4">Game Over!</h2>
                <div id="new-best-score-text" class="text-2xl font-semibold text-yellow-500 mb-4 hidden">New Best Score!</div>
                <div class="text-xl mb-2">Final Score: <span id="final-score" class="font-bold">0</span></div>
                <div class="text-xl mb-6">Your Rank: <span id="rank" class="font-bold"></span></div>
                <div class="text-lg mb-8">
                    <div>Best (Easy): <span id="end-best-score-easy" class="font-bold">0</span></div>
                    <div>Best (Hard): <span id="end-best-score-hard" class="font-bold">0</span></div>
                </div>
                
                <div class="text-md text-neutral-600 dark:text-neutral-400 mb-8">
                    <div>Library: <span id="end-library" class="font-bold"></span></div>
                    <div>Mode: <span id="end-mode" class="font-bold"></span></div>
                </div>
                <button id="play-again-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                    Play Again
                </button>
            </div>
        </div>
        <div id="help-modal" class="hidden absolute inset-0 bg-neutral-900 bg-opacity-80 flex items-center justify-center p-4 z-50">
            <div class="bg-white dark:bg-neutral-800 rounded-lg shadow-2xl p-6 w-full max-w-md relative">
                <h2 class="text-2xl font-bold mb-4 text-center">Color Reference</h2>
                <button id="close-help-btn" class="absolute top-3 right-4 text-neutral-500 hover:text-neutral-800 dark:hover:text-neutral-200 text-3xl font-bold leading-none" aria-label="Close">&times;</button>
                
                <div id="color-list-container" class="max-h-[60vh] overflow-y-auto pr-2">
                    </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA: Now loaded from CSV ---
        
        // --- Game State Variables ---
        let currentColorLibrary = []; // This will hold the loaded colors
        let score = 0;
        let currentRound = 0;
        let bestScoreEasy = 0;
        let bestScoreHard = 0;
        let currentCorrectColor = null;
        let gameMode = 'colorToName'; // 'colorToName' or 'nameToColor'
        let processingAnswer = false;
        let isHardMode = false;
        const TOTAL_ROUNDS = 20;
 
        // --- DOM Elements ---
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');
        
        const startBtn = document.getElementById('start-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        
        const scoreEl = document.getElementById('score');
        const bestScoreEl = document.getElementById('best-score');
        const startBestScoreEasyEl = document.getElementById('start-best-score-easy');
        const startBestScoreHardEl = document.getElementById('start-best-score-hard');
        
        const currentRoundEl = document.getElementById('current-round');
        const totalRoundsEl = document.getElementById('total-rounds');
        
        const questionTextEl = document.getElementById('question-text');
        const colorDisplayEl = document.getElementById('color-display');
        const optionsContainer = document.getElementById('options-container');
        const feedbackEl = document.getElementById('feedback');
        
        const finalScoreEl = document.getElementById('final-score');
        const rankEl = document.getElementById('rank');
        const endBestScoreEasyEl = document.getElementById('end-best-score-easy');
        const endBestScoreHardEl = document.getElementById('end-best-score-hard');
        const newBestScoreText = document.getElementById('new-best-score-text');

        // === NEW: End Screen Details ===
        const endLibraryEl = document.getElementById('end-library');
        const endModeEl = document.getElementById('end-mode');
        // === END NEW ===

        // Help Modal Elements
        const helpBtn = document.getElementById('help-btn');
        const helpModal = document.getElementById('help-modal');
        const closeHelpBtn = document.getElementById('close-help-btn');
        const colorListContainer = document.getElementById('color-list-container');
        
        const librarySelect = document.getElementById('library-select');
 
        // --- NEW: CSV Loading Functions ---
        
        async function loadColorLibrary(filename) {
            try {
                const response = await fetch(filename);
                if (!response.ok) {
                    throw new Error(`Failed to load library: ${response.statusText}`);
                }
                const csvText = await response.text();
                const colors = parseCSV(csvText);
                currentColorLibrary = colors; // Update the global state
                
                populateColorList();
                
                const selectedOption = librarySelect.querySelector(`option[value="${filename}"]`);
                if (selectedOption) {
                    const baseText = selectedOption.dataset.basename;
                    selectedOption.text = `${baseText} (${colors.length})`;
                }

                console.log(`Loaded ${colors.length} colors from ${filename}`);
            } catch (error) {
                console.error("Error loading color library:", error);
                alert(`Could not load color library '${filename}'. Please check the file and try again. Using a fallback list.`);
                currentColorLibrary = [
                    { name: "red", hex: "#ff0000" }, 
                    { name: "green", hex: "#008000" }, 
                    { name: "blue", hex: "#0000ff" }
                ];
                populateColorList();
            }
        }

        function parseCSV(text) {
            const lines = text.split('\n');
            const colors = [];
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const parts = line.split(',');
                if (parts.length >= 2) {
                    const name = parts[0].trim();
                    const hex = parts[1].trim();
                    if (name && hex.startsWith('#')) {
                        colors.push({ name, hex });
                    } else {
                        console.warn(`Skipping malformed CSV line: ${line}`);
                    }
                }
            }
            return colors;
        }

        // --- Utility Functions ---

        function formatColorName(name) {
            const spacedName = name.replace(/([A-Z])/g, ' $1');
            return spacedName.replace(/\b(\w)/g, char => char.toUpperCase());
        }
 
        function getScoreKey(isHard) {
            const filename = librarySelect.value;
            const mode = isHard ? 'hard' : 'easy';
            return `colorGameBestScore_${mode}_${filename}`;
        }
 
        function loadBestScore() {
            const easyKey = getScoreKey(false);
            const hardKey = getScoreKey(true);
            
            bestScoreEasy = localStorage.getItem(easyKey) || 0;
            bestScoreHard = localStorage.getItem(hardKey) || 0;
            
            startBestScoreEasyEl.textContent = bestScoreEasy;
            startBestScoreHardEl.textContent = bestScoreHard;
            endBestScoreEasyEl.textContent = bestScoreEasy;
            endBestScoreHardEl.textContent = bestScoreHard;
            
            bestScoreEl.textContent = isHardMode ? bestScoreHard : bestScoreEasy;
        }
 
        function saveBestScore() {
            if (isHardMode) {
                if (score > bestScoreHard) {
                    bestScoreHard = score;
                    localStorage.setItem(getScoreKey(true), bestScoreHard);
                    newBestScoreText.classList.remove('hidden');
                }
            } else {
                if (score > bestScoreEasy) {
                    bestScoreEasy = score;
                    localStorage.setItem(getScoreKey(false), bestScoreEasy);
                    newBestScoreText.classList.remove('hidden');
                }
            }
            loadBestScore();
        }
 
        function getRandomElement(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function shuffleArray(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }
 
        // --- New Help Modal Functions ---
        function populateColorList() {
            const list = document.createElement('div');
            list.className = 'flex flex-col gap-2';
            
            const sortedColors = [...currentColorLibrary].sort((a, b) => a.name.localeCompare(b.name));

            sortedColors.forEach(color => {
                const item = document.createElement('div');
                item.className = 'flex items-center space-x-4 p-2 bg-neutral-100 dark:bg-neutral-700 rounded-md shadow-sm';
                
                const swatch = document.createElement('div');
                swatch.className = 'w-10 h-10 rounded border border-neutral-300 dark:border-neutral-600 shrink-0';
                swatch.style.backgroundColor = color.hex;
                
                const name = document.createElement('span');
                name.className = 'text-sm font-medium';
                name.textContent = formatColorName(color.name);
                
                item.appendChild(swatch);
                item.appendChild(name);
                list.appendChild(item);
            });
            colorListContainer.innerHTML = '';
            colorListContainer.appendChild(list);
        }

        function showHelpModal() {
            helpModal.classList.remove('hidden');
        }

        function hideHelpModal() {
            helpModal.classList.add('hidden');
        }

        // --- Hard Mode Helper Functions ---

        function hexToRgb(hex) {
            if (!hex || hex.length !== 7 || hex[0] !== '#') {
                console.error('Invalid hex color:', hex);
                return { r: 0, g: 0, b: 0 };
            }
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return { r, g, b };
        }

        function colorDistance(color1, color2) {
            const rgb1 = hexToRgb(color1.hex);
            const rgb2 = hexToRgb(color2.hex);
            return Math.sqrt(
                Math.pow(rgb2.r - rgb1.r, 2) +
                Math.pow(rgb2.g - rgb1.g, 2) +
                Math.pow(rgb2.b - rgb1.b, 2)
            );
        }

        function getCloseColors(correctColor, num) {
            const distances = currentColorLibrary
                .filter(color => color.hex !== correctColor.hex) 
                .map(color => ({
                    color: color,
                    distance: colorDistance(correctColor, color)
                }));

            distances.sort((a, b) => a.distance - b.distance);

            const closestColors = [];
            const addedNames = new Set([correctColor.name]);

            for (const d of distances) {
                if (closestColors.length >= num - 1) break;
                if (!addedNames.has(d.color.name)) {
                    closestColors.push(d.color);
                    addedNames.add(d.color.name);
                }
            }
            
            while (closestColors.length < num - 1) {
                const randomColor = getRandomElement(currentColorLibrary);
                if (!addedNames.has(randomColor.name)) {
                    closestColors.push(randomColor);
                    addedNames.add(randomColor.name);
                }
            }
            return [correctColor, ...closestColors];
        }
 
        // --- Game Logic Functions ---
 
        function startGame() {
            score = 0;
            currentRound = 0;
            scoreEl.textContent = score;
            newBestScoreText.classList.add('hidden');
            
            isHardMode = document.getElementById('hard-mode-toggle').checked;
            
            startScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            
            loadBestScore();
            bestScoreEl.textContent = isHardMode ? bestScoreHard : bestScoreEasy;
            
            totalRoundsEl.textContent = TOTAL_ROUNDS;
            nextRound();
        }
 
        function nextRound() { 
            currentRound++;
            if (currentRound > TOTAL_ROUNDS) { 
                endGame();
                return;
            }
            currentRoundEl.textContent = currentRound;

            if (currentColorLibrary.length < 4) {
                alert("The selected color library is too small to play (requires at least 4 unique colors). Please select a different library.");
                gameScreen.classList.add('hidden');
                startScreen.classList.remove('hidden');
                return;
            }

            processingAnswer = false;
            feedbackEl.textContent = '';
            feedbackEl.classList.remove('text-green-500', 'text-red-500', 'feedback-pop');
            optionsContainer.innerHTML = ''; 
 
            let chosenColors;
            let options;
            
            currentCorrectColor = getRandomElement(currentColorLibrary);

            if (isHardMode) {
                chosenColors = getCloseColors(currentCorrectColor, 4);
            } else {
                const otherColors = new Set();
                const addedNames = new Set([currentCorrectColor.name]);
                
                while (otherColors.size < 3) {
                    const randomColor = getRandomElement(currentColorLibrary);
                    if (!addedNames.has(randomColor.name)) {
                        otherColors.add(randomColor);
                        addedNames.add(randomColor.name);
                    }
                }
                chosenColors = [currentCorrectColor, ...Array.from(otherColors)];
            }
            
            options = shuffleArray(chosenColors);
            
            gameMode = Math.random() < 0.5 ? 'colorToName' : 'nameToColor';

            if (gameMode === 'colorToName') {
                questionTextEl.textContent = 'What color is this?';
                colorDisplayEl.style.backgroundColor = currentCorrectColor.hex;
                const brightness = getBrightness(currentCorrectColor.hex);
                colorDisplayEl.textContent = '';
                colorDisplayEl.classList.remove('text-white', 'text-black');
                colorDisplayEl.classList.add(brightness > 128 ? 'text-black' : 'text-white');

                options.forEach(color => {
                    const button = document.createElement('button');
                    button.textContent = formatColorName(color.name);
                    button.dataset.value = color.name;
                    button.className = "option-btn w-full h-20 md:h-24 bg-neutral-200 dark:bg-neutral-700 hover:bg-neutral-300 dark:hover:bg-neutral-600 font-semibold rounded-lg shadow-md transition-all duration-150 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base";
                    button.onclick = () => checkAnswer(color.name);
                    optionsContainer.appendChild(button);
                });

            } else {
                questionTextEl.textContent = 'Which color is...';
                colorDisplayEl.style.backgroundColor = '';
                colorDisplayEl.textContent = formatColorName(currentCorrectColor.name);
                colorDisplayEl.classList.remove('text-white', 'text-black');
                colorDisplayEl.classList.add('text-neutral-900', 'dark:text-neutral-100');

                options.forEach(color => {
                    const button = document.createElement('button');
                    button.style.backgroundColor = color.hex;
                    button.dataset.value = color.name;
                    
                    const brightness = getBrightness(color.hex);
                    const textColorClass = brightness > 128 ? 'text-black' : 'text-white';
                    button.innerHTML = `<span class="opacity-0 group-hover:opacity-100 ${textColorClass} color-btn-text font-semibold text-sm transition-opacity">?</span>`;
                    
                    button.className = `option-btn w-full h-20 md:h-24 font-semibold rounded-lg shadow-md transition-all duration-150 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 group flex items-center justify-center`;
                    button.onclick = () => checkAnswer(color.name);
                    optionsContainer.appendChild(button);
                });
            }
        }
        
        function getBrightness(hex) {
            if (!hex || hex.length !== 7 || hex[0] !== '#') {
                console.warn('Invalid hex color for brightness:', hex);
                return 0;
            }
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return (0.299 * r + 0.587 * g + 0.114 * b);
        }

        function checkAnswer(selectedValue) {
            if (processingAnswer) return;
            processingAnswer = true;

            const correctValue = currentCorrectColor.name;
            const friendlyCorrectName = formatColorName(currentCorrectColor.name);
            const friendlyPickedName = formatColorName(selectedValue);

            if (selectedValue === correctValue) {
                score++;
                feedbackEl.textContent = 'Correct!';
                feedbackEl.className = 'mt-6 text-center text-lg font-semibold h-8 text-green-500 dark:text-green-400 feedback-pop';
            } else {
                if (gameMode === 'colorToName') {
                    feedbackEl.textContent = `Wrong! The correct answer was ${friendlyCorrectName}`;
                } else {
                    feedbackEl.textContent = `Wrong! You picked ${friendlyPickedName}`;
                }
                feedbackEl.className = 'mt-6 text-center text-lg font-semibold h-8 text-red-500 dark:text-red-400 feedback-pop';
            }
 
            scoreEl.textContent = score;

            setTimeout(nextRound, 1200);
        }

        // === UPDATED: endGame Function ===
        function endGame() {
            finalScoreEl.textContent = score;
            rankEl.textContent = getRank(score);
            
            // === NEW ===
            // Get the full text of the selected option (e.g., "W3 Colors (147)")
            const libraryName = librarySelect.options[librarySelect.selectedIndex].text;
            const modeName = isHardMode ? "Hard" : "Easy";
            endLibraryEl.textContent = libraryName;
            endModeEl.textContent = modeName;
            // === END NEW ===

            saveBestScore(); // This also updates the 'end-best-score' text
            
            gameScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');
        }
        // === END UPDATE ===

        function getRank(score) {
            const percentage = score / TOTAL_ROUNDS;
            if (percentage <= 0.25) return "Color Pleb";
            if (percentage <= 0.5) return "Color Noob";
            if (percentage <= 0.75) return "Color Middle Manager";
            if (percentage <= 0.9) return "Color Connoisseur";
            if (percentage === 1) return "Color Lord";
            return "Color Connoisseur"; // Default for scores like 19/20
        }

        // --- Event Listeners ---
        startBtn.addEventListener('click', startGame);
        playAgainBtn.addEventListener('click', () => {
            endScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
            loadBestScore(); // Update best score on start screen
        });
        
        helpBtn.addEventListener('click', showHelpModal);
        closeHelpBtn.addEventListener('click', hideHelpModal);
        helpModal.addEventListener('click', (e) => {
            if (e.target === helpModal) {
                hideHelpModal();
            }
        });

        librarySelect.addEventListener('change', async (e) => {
            const selectedFile = e.target.value;
            helpBtn.textContent = "Loading Library...";
            await loadColorLibrary(selectedFile);
            loadBestScore();
            helpBtn.textContent = "Show Color Reference";
        });

        // --- Initial Load ---
        async function initializeGame() {
            totalRoundsEl.textContent = TOTAL_ROUNDS;
            
            const optionsToLoad = Array.from(librarySelect.options);
            const defaultLibraryFile = librarySelect.value;
            let defaultLibraryData = null;

            const loadPromises = optionsToLoad.map(async (option) => {
                const filename = option.value;
                const baseText = option.dataset.basename;
                
                try {
                    const response = await fetch(filename);
                    if (!response.ok) throw new Error(`HTTP error ${response.status}`);
                    const csvText = await response.text();
                    const colors = parseCSV(csvText);
                    
                    option.text = `${baseText} (${colors.length})`;
                    
                    if (filename === defaultLibraryFile) {
                        defaultLibraryData = colors;
                    }
                } catch (e) {
                    console.error(`Failed to load count for ${filename}`, e);
                    option.text = `${baseText} (Error)`;
                }
            });

            await Promise.all(loadPromises);

            if (defaultLibraryData) {
                currentColorLibrary = defaultLibraryData;
                populateColorList();
            } else {
                console.error("Default library failed to load, running fallback.");
                await loadColorLibrary(defaultLibraryFile);
Half-Life 3            }
            
            loadBestScore();
        }

        initializeGame();

    </script>
</body>
</html>